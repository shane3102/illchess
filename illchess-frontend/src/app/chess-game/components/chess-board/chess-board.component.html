<div *ngIf="boardView$ | async as boardView">
    
    <div style="position: absolute" *ngIf="gameState$ | async as gameState">
        @if(gameState == 'CHECKMATE' || gameState ==  'STALEMATE' || gameState ==  'RESIGNED' || gameState ==  'DRAW') {
            <app-game-finished-popup
                [boardGameObtainedInfoView]="boardGameObtainedInfoView$ | async" 
                [gameFinishedView]="gameFinishedView$ | async"
                [gameState]="gameState">
            </app-game-finished-popup>
        }
    </div>

    <div style="position: absolute;">
        @if(!boardView.blackUsername) {
            <app-waiting-for-black-popup [boardId]="boardId" [username]="username"></app-waiting-for-black-popup>
        }
    </div>

    <div *ngFor="let rank of ranks">
        <div style="display: flex; justify-content: center;">
            <div *ngFor="let file of files">
                <app-chess-square 
                    (pieceDraggedInfoEmitter)="pieceDraggedChange($event)"
                    (pieceDroppedInfoEmitter)="pieceDroppedChange($event)"
                    (pieceDraggedReleasedInfoEmitter)="pieceDraggedRelease()" 
                    [boardId]="boardId" 
                    [piece]="boardView?.piecesLocations ? 
                    boardView?.piecesLocations![file+rank] ? 
                    boardView?.piecesLocations![file+rank] : 
                    undefined : 
                    undefined" 
                    [illegalMoveResponse]="illegalMoveResponse$"
                    [draggedPieceInfo]="draggedPieceInfo$ | async" 
                    [squareInfo]="{file: file, rank: rank}"
                    [legalMoves]="legalMoves$ | async" 
                    [username]="username"
                    [lastPerformedMove]="boardView?.lastPerformedMove"
                    [preMoves]="boardView?.preMoves"
                    [gameState]="gameState$ | async"
                    [currentPlayerColor]="currentPlayerColor$ | async"
                    [victoriousPlayerColor]="victoriousPlayerColor$ | async">
                </app-chess-square>
            </div>
        </div>
    </div>

</div>
